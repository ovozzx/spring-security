<!DOCTYPE html>
<html>
    <head>
        <title>Chatting</title>
        <meta charset="UTF-8" /> 
        <link type="text/css" 
		      rel="stylesheet" 
		      href="/css/hello-spring.css" />
        <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
        <script type="text/javascript">
            function receiveChat(receiveData) {
                console.log(receiveData);
                // [2025-10-20] Chatting Room 보관
                if (roomName === receiveData.room) {
                    var history = $("<li></li>");
                    var loginUserEmail = $(opener.document).find("#login-user-email")
                                                   .text();
                    
                    if (loginUserEmail === receiveData.userEmail) {
                        history.addClass("my-chat");
                    }
                    
                    var username = $("<div></div>");
                    username.text(receiveData.username);
                    
                    var message = $("<div></div>");
                    message.text(receiveData.message);
                    
                    history.append(username);
                    history.append(message);
                    
                    $(".chat").children(".history").append(history);
                }
            }
            
            // [2025-10-20] Chatting Room 보관
            var roomName = null;
            $().ready(function() {

            	// [2025-10-20] Chatting Room 보관
            	roomName = window.location.search.split("=")[1];
            	
                $(".message").on("keyup", function(event) {
                    if (event.keyCode === 13) {
                        // [2025-10-20] Chatting Room 보관
                        opener.sendChat( $(this).val(), roomName);
                        $(this).val("");
                    }
                });
            });
        </script>
    </head>
    <body>
        <div class="chat">
            <ul class="history"></ul>
            <div class="chat-message-input">
                <input type="text" class="message" />
            </div>
        </div>
    </body>
</html>